"use strict";exports.id=169,exports.ids=[169],exports.modules={22389:(e,r,s)=>{s.d(r,{i:()=>f,$:()=>E});var a=s(67218);s(79130);var t=s(31183),i=s(5486),o=s.n(i),n=s(58111),m=s(62351),d=s(84113),l=s(45697);let u={requiredEmail:"Email is required",validEmail:"Invalid email format",requiredPassword:"Password is required",passwordMinLength:"Password must be at least 6 characters",passwordMaxLength:"Password must be less than 40 characters",requiredName:"Name is required",nameMaxLength:"Name must be less than 50 characters",requiredConfirmPassword:"Password confirmation is required",passwordsDoNotMatch:"Passwords do not match",validLimit:"Limit must be a positive integer",limitMax:"Limit must be 100 or less"},c=e=>({isValid:e.password===e.confirmPassword,issue:{message:u.passwordsDoNotMatch,path:["confirmPassword"]}}),g=()=>l.z.object({email:l.z.string().trim().min(1,{message:u.requiredEmail}).email({message:u.validEmail}).transform(e=>e.toLowerCase()),password:l.z.string().min(1,{message:u.requiredPassword}).min(6,{message:u.passwordMinLength}).max(40,{message:u.passwordMaxLength})}),p=()=>l.z.object({name:l.z.string().trim().min(1,{message:u.requiredName}).max(50,{message:u.nameMaxLength}),email:l.z.string().trim().min(1,{message:u.requiredEmail}).email({message:u.validEmail}).transform(e=>e.toLowerCase()),password:l.z.string().min(1,{message:u.requiredPassword}).min(6,{message:u.passwordMinLength}).max(40,{message:u.passwordMaxLength}),confirmPassword:l.z.string().min(1,{message:u.requiredConfirmPassword}),limit:l.z.number().int().min(1,{message:u.validLimit}).max(100,{message:u.limitMax}).default(1)}).refine(e=>c(e).isValid,e=>c(e).issue);var w=s(96330);async function f(e,r){if(!e?.email||!e?.password)return{status:400,message:"Email and password are required",className:"text-red-500"};let s=g().safeParse(e);if(!s.success)return{status:400,error:s.error.formErrors.fieldErrors,className:"text-red-500"};try{let e=await t.db.user.findUnique({where:{email:s.data.email},select:{id:!0,email:!0,name:!0,password:!0,role:!0,createdAt:!0,updatedAt:!0}});if(!e)return{status:401,message:"User not found",className:"text-red-500"};if(!await o().compare(s.data.password,e.password))return{status:401,message:"Incorrect password",className:"text-red-500"};let{password:r,...a}=e;return{status:200,message:"Login successful",user:a,className:"text-green-500"}}catch(s){let r=s instanceof w.Prisma.PrismaClientKnownRequestError?`Prisma error: ${s.code} - ${s.message}`:s instanceof Error?s.message:"Unknown error";return console.error("❌ Login Error:",{error:r,timestamp:new Date().toISOString(),email:e.email}),{status:500,message:"An unexpected error occurred",error:r,className:"text-red-500"}}}async function E(e,r){let s=Object.fromEntries(r.entries()),a=p().safeParse(s);if(!a.success)return{status:400,error:a.error.formErrors.fieldErrors,formData:r,className:"text-red-500"};try{if(await t.db.user.findUnique({where:{email:a.data.email},select:{id:!0}}))return{status:409,message:"User already exists",formData:r,className:"text-red-500"};let e=await o().hash(a.data.password,10),s=await t.db.user.create({data:{id:(0,d.A)(),name:a.data.name,email:a.data.email,password:e,role:"USER"},select:{id:!0,name:!0,email:!0,role:!0}}),i=`/${n.BV.ADMIN}`;return(0,m.revalidatePath)(`${i}/${n.bQ.USERS}/${s.id}/${n.bQ.EDIT}`),(0,m.revalidatePath)(`${i}/${n.bQ.USERS}`),{status:201,message:"Registration successful",user:s,className:"text-green-500"}}catch(r){let e=r instanceof w.Prisma.PrismaClientKnownRequestError?`Prisma error: ${r.code} - ${r.message}`:r instanceof Error?r.message:"Unknown error";return console.error("❌ Signup Error:",{error:e,timestamp:new Date().toISOString(),email:a.data.email}),{status:500,message:"An unexpected error occurred",error:e,className:"text-red-500"}}}(0,s(17478).D)([f,E]),(0,a.A)(f,"602b3b0f4ed3ef3a7c3773b6e52602ee4db174b929",null),(0,a.A)(E,"60f3fb9bfba88add6133f5c33fb906cdad4945dbbc",null)},31183:(e,r,s)=>{s.d(r,{db:()=>t});var a=s(96330);let t=global.prisma||new a.PrismaClient;new a.PrismaClient},33169:(e,r,s)=>{s.d(r,{N:()=>m});var a=s(58111),t=s(13581),i=s(60890),o=s(31183),n=s(22389);let m={adapter:(0,i.y)(o.db),providers:[(0,t.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email",placeholder:"example@email.com"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Email and password are required");try{let r=await (0,n.i)(e,a.AT.ENGLISH);if(200===r.status&&r.user)return{id:r.user.id,name:r.user.name,email:r.user.email,role:r.user.role};throw Error(JSON.stringify({validationError:r.error,responseError:r.message}))}catch(e){throw console.error("Auth Error:",e),Error("Authentication failed. Please try again.")}}})],callbacks:{async jwt({token:e,user:r}){try{if(r)return{id:r.id,name:r.name,email:r.email,role:r.role,image:r.image??null,phone:r.phone??null,country:r.country??null,city:r.city??null,postalCode:r.postalCode??null,streetAddress:r.streetAddress??null};if(!e.email)return e;let s=await o.db.user.findUnique({where:{email:e.email},select:{id:!0,name:!0,email:!0,role:!0,image:!0,phone:!0,country:!0,city:!0,postalCode:!0,streetAddress:!0}});if(!s)return e;return{id:s.id,name:s.name,email:s.email,role:s.role,image:s.image??null,phone:s.phone??null,country:s.country??null,city:s.city??null,postalCode:s.postalCode??null,streetAddress:s.streetAddress??null}}catch(r){return console.error("JWT Callback Error:",r),e}},session:({session:e,token:r})=>(r&&(e.user={id:r.id,name:r.name,email:r.email,role:r.role,image:r.image,phone:r.phone,country:r.country,city:r.city,postalCode:r.postalCode,streetAddress:r.streetAddress}),e)},session:{strategy:"jwt",maxAge:604800,updateAge:86400},pages:{signIn:`/${a.BV.AUTH}/${a.bQ.LOGIN}`,error:`/${a.BV.AUTH}/error`},secret:process.env.NEXTAUTH_SECRET,debug:"production"===a.B5.DEV}},58111:(e,r,s)=>{s.d(r,{AT:()=>a,B5:()=>o,BV:()=>t,bQ:()=>i});var a=function(e){return e.ENGLISH="en",e.ARABIC="ar",e}({}),t=function(e){return e.ROOT="",e.MENU="menu",e.ABOUT="about",e.CONTACT="contact",e.AUTH="auth",e.CART="cart",e.PROFILE="profile",e.ADMIN="admin",e.PORTFOLIO="PORTFOLIO",e.SETTINGS="SETTINGS",e}({}),i=function(e){return e.LOGIN="/signin",e.Register="/signup",e.FORGOT_PASSWORD="forgot-password",e.CATEGORIES="categories",e.MENU_ITEMS="menu-items",e.USERS="users",e.ORDERS="orders",e.NEW="new",e.EDIT="edit",e.DASHBOARD="Dashboard",e.CUSTOMERS="Customers",e.SALES="Sales",e.PRODUCTS="PRODUCTS",e.LOGOUT="LOGOUT",e}({}),o=function(e){return e.PROD="production",e.DEV="development",e}({})}};